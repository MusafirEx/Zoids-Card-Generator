<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zoids Card Generator</title>
  <style>
    @font-face {
      font-family: 'Bigmacca';
      src: url('bigmacca.ttf') format('truetype');
    }
    body {
      font-family: Arial, sans-serif;
      padding: 10px;
      margin: 0;
      background: #222;
      color: #fff;
    }
    input, select, textarea, button {
      display: block;
      width: 100%;
      margin-bottom: 10px;
      padding: 8px;
      box-sizing: border-box;
    }
    canvas {
      border: 2px solid #fff;
      background: #ddd;
      display: block;
      margin: 20px auto;
      width: 100%;
      max-width: 350px;
      height: auto;
    }
    label {
      margin-top: 10px;
      font-weight: bold;
    }
    .controls, .image-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin-top: 10px;
    }
    .controls button, .image-controls button {
      width: auto;
      padding: 10px 15px;
      font-size: 16px;
    }
    .container {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }
    @media (max-width: 600px) {
      .controls, .image-controls {
        flex-direction: column;
        align-items: center;
      }
      .controls button, .image-controls button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <img src="banner.png" alt="Zoids Card Generator" style="width: 100%; max-width: 600px; display: block; margin: 0 auto 20px auto;" />
  <h1 style="text-align: center;">Zoids Card Generator</h1>
  
  <label for="cardName">Card Name</label>
  <input type="text" id="cardName" placeholder="Zoids Name" />

  <label for="cardType">Type</label>
  <select id="cardType">
    <option value="Zoids">Zoids</option>
    <option value="Pilot">Pilot</option>
    <option value="Weapons">Weapons</option>
    <option value="Organoid">Organoid</option>
  </select>

  <label for="level">Level</label>
  <input type="number" id="level" placeholder="1" />

  <label for="description">Card Description</label>
  <textarea id="description" rows="4" placeholder="The Blade Liger („Éñ„É¨„Éº„Éâ„É©„Ç§„Ç¨„Éº, Burƒìdo RaigƒÅ) is a Lion-type Zoid."></textarea>

  <label for="atk">ATK</label>
  <input type="number" id="atk" placeholder="3000" />

  <label for="def">DEF</label>
  <input type="number" id="def" placeholder="2500" />

  <label for="imageUpload">Zoids Image(Transparent background)</label>
  <input type="file" id="imageUpload" accept="image/*" />

  <label>Image Controls</label>
  <div class="image-controls">
    <button onclick="moveImage(-10, 0)">‚Üê Left</button>
    <button onclick="moveImage(10, 0)">‚Üí Right</button>
    <button onclick="moveImage(0, -10)">‚Üë Up</button>
    <button onclick="moveImage(0, 10)">‚Üì Down</button>
    <button onclick="resizeImage(10, 0)">Width +</button>
    <button onclick="resizeImage(-10, 0)">Width -</button>
    <button onclick="resizeImage(0, 10)">Height +</button>
    <button onclick="resizeImage(0, -10)">Height -</button>
  </div>

  <div class="container">
    <canvas id="cardCanvas" width="350" height="500"></canvas>
  </div>

  <button onclick="downloadCard()">Download Card</button>

  <script>
    let imgX = 25, imgY = 100, imgWidth = 300, imgHeight = 200;
    let uploadedImage = null;

    document.querySelectorAll('input, select, textarea').forEach(el => {
      el.addEventListener('input', generateCard);
    });

    document.getElementById("imageUpload").addEventListener("change", function() {
      const file = this.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          uploadedImage = new Image();
          uploadedImage.onload = generateCard;
          uploadedImage.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    function moveImage(dx, dy) {
      imgX += dx;
      imgY += dy;
      generateCard();
    }

    function resizeImage(dw, dh) {
      imgWidth += dw;
      imgHeight += dh;
      generateCard();
    }

    async function generateCard() {
      const canvas = document.getElementById("cardCanvas");
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const name = document.getElementById("cardName").value;
      const type = document.getElementById("cardType").value;
      const level = document.getElementById("level").value;
      const desc = document.getElementById("description").value;
      const atk = document.getElementById("atk").value;
      const def = document.getElementById("def").value;

      let frameSrc = '';
      if (type === "Zoids") frameSrc = "frame-zoids.png";
      if (type === "Pilot") frameSrc = "frame-pilot.png";
      if (type === "Weapons") frameSrc = "frame-weapons.png";
      if (type === "Organoid") frameSrc = "frame-organoid.png";

      const frameImg = new Image();
      frameImg.src = frameSrc;
      await frameImg.decode();
      ctx.drawImage(frameImg, 0, 0, 350, 500);

      if (uploadedImage) {
        ctx.drawImage(uploadedImage, imgX, imgY, imgWidth, imgHeight);
      }

      ctx.font = "15px Bigmacca";
      ctx.strokeStyle = "#000";
      ctx.textAlign = "center";
      ctx.fillText('level', 40, 30);
      
      ctx.font = "italic 20px Bigmacca";
      ctx.fillStyle = "#FFD700";
      ctx.strokeStyle = "#000";
      ctx.textAlign = "left";
      ctx.strokeText(name, 90, 63);
      ctx.fillText(name, 90, 63);

      ctx.font = "40px Bigmacca";
      ctx.strokeStyle = "#000";
      ctx.textAlign = "center";
      ctx.strokeText(level, 40, 65);
      ctx.fillText(level, 40, 65);

      ctx.font = "italic 16px Bigmacca";
      ctx.fillStyle = "#000";
      ctx.strokeStyle = "#fff";
      ctx.strokeText('ATK', 120, 30);
      ctx.fillText('atk', 120, 30);
      ctx.strokeText('def', 245, 30);
      ctx.fillText('def', 245, 30);

      ctx.font = "italic 16px Bigmacca";
      ctx.fillStyle = "#FFD700";
      ctx.textAlign = "right";
      ctx.fillText(atk, 205, 30);
      ctx.fillText(def, 330, 30);
    

      ctx.font = "italic bold 10px Arial";
      ctx.fillStyle = "#000";
      ctx.textAlign = "left";
      wrapText(ctx, desc, 30, 470, 300, 10);
    }

    function wrapText(context, text, x, y, maxWidth, lineHeight) {
      const words = text.split(' ');
      let line = '';
      for (let n = 0; n < words.length; n++) {
        const testLine = line + words[n] + ' ';
        const metrics = context.measureText(testLine);
        const testWidth = metrics.width;
        if (testWidth > maxWidth && n > 0) {
          context.fillText(line, x, y);
          line = words[n] + ' ';
          y += lineHeight;
        } else {
          line = testLine;
        }
      }
      context.fillText(line, x, y);
    }

    function downloadCard() {
      const canvas = document.getElementById("cardCanvas");
      const link = document.createElement('a');
      link.download = 'zoids-card.png';
      link.href = canvas.toDataURL();
      link.click();
    }
  </script>

  <!-- Visit Counter -->
  <div style="text-align: center; margin-top: 30px;">
    <p id="visitCounter">Visits: Loading...</p>
  </div>

  <script>
    // üî¢ Visit Counter using CountAPI
    fetch('https://api.countapi.xyz/hit/zoidscardgen/visits')
      .then(response => response.json())
      .then(data => {
        document.getElementById('visitCounter').textContent = `Visits: ${data.value}`;
      })
      .catch(err => {
        document.getElementById('visitCounter').textContent = 'Visit count unavailable';
        console.error('Visit counter error:', err);
      });
  </script>

</body>
</html>
